---
title: More NMF analyses of the swimmer dataset
author: Peter Carbonetto
output:
  workflowr::wflow_html:
    toc: no
    theme: readable
    highlight: textmate
    lib_dir: site_libs
    self_contained: no
---

ADD TEXT HERE.

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

First load the packages and some custom functions needed for the
analysis below.

```{r load-pkgs, message=FALSE}
library(R.matlab)
library(tibble)
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)
source("code/swimmer_functions.R")
```

Initialize the sequence of pseudorandom numbers.

```{r set-seed}
set.seed(1)
```

Load the swimmer data set.

```{r load-swimmer}
Y <- readMat("data/swimmer.mat")$Y
Y <- apply(Y,3,as.vector)
Y <- Y - 1
```

This is the decomposition produced by "vanilla NMF" with 16
faactorsâ€”by "vanilla", we meaan NMF without any penalties on the
parameters. See the
[swimmer.m](https://github.com/willwerscheid/ebnmf-paper/blob/master/matlab/swimmer.m)
script for details.

```{r vanilla-nmf, fig.height=2, fig.width=7}
nmf <- readMat("matlab/swimmer_nmf.mat")
plot_images(nmf$W,nrow = 2,ncol = 8)
```

Vanilla NMF doesn't identify the correct "parts" because all the
factors include the torso. So perhaps encouraging the parts to be more
sparse --- and therefore capturing more local features --- would help
deal with this. In this second attempt, also implemented in the
**swimmer.m** script, we forced the average sparsity of the 17 factors
to be at least 0.95:

```{r sparse-nmf, fig.height=3, fig.width=7}
sparse_nmf <- readMat("matlab/swimmer_nmf_sW=0.95.mat")
plot_images(sparse_nmf$W,nrow = 3,ncol = 8)
```

However, this doesn't seem to do the right thing: the solution
satisfies the sparsity constraint by forcing some of the factors to
represent multiple parts, which is sort of the opposite of what we
actually want.

Note that the vanilla NMF estimates are already very sparse which is
why we need to set the sparsity constraint on $\mathbf{W}$ to be so high
(0.95):

```{r compare-sparsity}
mean(nmf$sp)
mean(sparse_nmf$sp)
```
